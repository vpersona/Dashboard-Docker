<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Docker Pulse Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: white; text-align: center; margin: 0; padding: 20px; }
        .dashboard-container { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .chart-wrapper { background: #1e1e1e; padding: 20px; border-radius: 15px; width: 80%; max-width: 900px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .stats-grid { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat-card { background: #252525; padding: 15px 30px; border-radius: 10px; border-top: 4px solid #00dbde; }
        .stat-value { font-size: 1.8em; font-weight: bold; color: #00dbde; }
        h1 { margin-bottom: 30px; color: #f0f0f0; text-transform: uppercase; letter-spacing: 2px; }
        .btn { padding: 4px 8px; margin-left: 5px; cursor: pointer; border: none; border-radius: 3px; font-size: 0.8em; color: white; }
        .btn-restart { background: #28a745; }
        .btn-stop { background: #dc3545; }
        .btn:hover { opacity: 0.8; }
    </style>
</head>
<body>

    <h1>Docker System Pulse</h1>
    <p id="os-info" style="color: #888;">Ładowanie informacji o systemie...</p>

    <script>
        fetch('/api/info').then(res => res.json()).then(data => {
            document.getElementById('os-info').innerText = `${data.node} | ${data.os} ${data.release}`;
        });
    </script>

    <div class="dashboard-container">
        <div class="stats-grid">
            <div class="stat-card">
                <div>CPU USAGE</div>
                <div id="cpu-text" class="stat-value">0%</div>
            </div>
            <div class="stat-card">
                <div>RAM USAGE</div>
                <div id="ram-text" class="stat-value">0%</div>
            </div>
        </div>

        <div class="chart-wrapper">
            <canvas id="realtimeChart"></canvas>
        </div>
        <div class="chart-wrapper" style="margin-top: 20px;">
        <h3>Aktywne Kontenery</h3>
            <div id="container-list" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; font-size: 0.9em;">
        </div>
        </div>
    </div>

    <script>
        const ctx = document.getElementById('realtimeChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [], 
                datasets: [
                    {
                        label: 'CPU %',
                        data: [],
                        borderColor: '#00dbde',
                        backgroundColor: 'rgba(0, 219, 222, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'RAM %',
                        data: [],
                        borderColor: '#ff007f',
                        backgroundColor: 'rgba(255, 0, 127, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true, 
                         grid: { color: '#333' } },
                    x: { grid: { display: false } }
                },
                plugins: { legend: { labels: { color: 'white' } } }
            }
        });

        function updateStats() {
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    const now = new Date().toLocaleTimeString();
                    const cpu = data.cpu.total;
                    const ram = data.mem.percent;

                    document.getElementById('cpu-text').innerText = cpu + '%';
                    document.getElementById('ram-text').innerText = ram + '%';

                    chart.data.labels.push(now);
                    chart.data.datasets[0].data.push(cpu);
                    chart.data.datasets[1].data.push(ram);

                    if (cpu > 80) {
                            document.getElementById('cpu-text').style.color = 'red';
                            document.body.style.backgroundColor = '#2a0000'; 
                        } else {
                            document.getElementById('cpu-text').style.color = '#00dbde';
                            document.body.style.backgroundColor = '#121212';
                        }

                    if (chart.data.labels.length > 15) {
                        chart.data.labels.shift();
                        chart.data.datasets[0].data.shift();
                        chart.data.datasets[1].data.shift();
                    }

                    chart.update('none'); 
                })
                .catch(err => console.error("Błąd pobierania danych:", err));
        }



        function updateContainers() {
            fetch('/api/containers')
                .then(response => response.json())
                .then(data => {
                    const listElement = document.getElementById('container-list');
                    listElement.innerHTML = ''; 
                    
                    data.forEach(container => {
                        const card = document.createElement('div');
                        card.style.cssText = "background: #333; padding: 10px; border-radius: 5px; border-left: 4px solid " + (container.status === 'running' ? '#00ff00' : '#ff0000');
                        card.innerHTML = `<strong>${container.name}</strong><br>Status: ${container.status}`;
                        listElement.appendChild(card);
                    });
                });
        }
   


        updateContainers();
        setInterval(updateContainers, 5000);
        setInterval(updateStats, 2000);
    </script>
</body>
</html>